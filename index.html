<!-- desa com dau.html i obre al navegador -->
<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <title>Dau de signes ‚Äî animat</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --text:#e6eef8;
      --muted:#9fb0c8;
      --plus:#27ae60;   /* verd */
      --minus:#e63946;  /* vermell */
      --zero:#f0b429;   /* groc/daurat */
      --accent:#3b82f6;
    }
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,system-ui,Roboto,Helvetica,Arial;}
    body{background:linear-gradient(180deg,var(--bg),#061022);display:flex;align-items:center;justify-content:center;color:var(--text);}
    .card{background:linear-gradient(180deg,var(--panel),#051425);padding:28px;border-radius:14px;box-shadow:0 8px 30px rgba(2,6,23,.6);width:min(540px,94vw);text-align:center;}
    h1{margin:0 0 8px;font-size:20px;}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:13px;}
    .dice{
      font-size:96px;
      font-weight:800;
      height:140px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      margin:12px 0;
      box-shadow: inset 0 -6px 20px rgba(0,0,0,0.6);
      letter-spacing:6px;
    }
    .controls{display:flex;gap:8px;justify-content:center;margin-top:10px;flex-wrap:wrap;}
    button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer;}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);}
    .result{margin-top:12px;color:var(--muted);font-size:13px;}
    .small{font-size:12px;color:var(--muted);margin-top:6px;}
    .legend{display:flex;gap:10px;justify-content:center;margin-top:10px;}
    .legend span{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);}
    .dot{width:12px;height:12px;border-radius:50%;}
    .plus{background:var(--plus);} .minus{background:var(--minus);} .zero{background:var(--zero);}
  </style>
</head>
<body>
  <div class="card">
    <h1>üé≤ Dau de signes ( + / - / 0 )</h1>
    <p class="lead">Com si fos un dau de 6 cares: 2 cares ‚Äú+‚Äù, 2 cares ‚Äú-‚Äù i 2 cares ‚Äú0‚Äù. Fes click a <strong>LLAN√áAR</strong> i mira l‚Äôanimaci√≥ amb frenada.</p>

    <div id="dice" class="dice">+</div>

    <div class="controls">
      <button id="rollBtn">LLAN√áAR</button>
      <button id="soundToggle" class="secondary">So: ON</button>
    </div>

    <div class="legend">
      <span><i class="dot plus"></i> +</span>
      <span><i class="dot minus"></i> -</span>
      <span><i class="dot zero"></i> 0</span>
    </div>

    <div class="result" id="resultText">Premeu "LLAN√áAR" per comen√ßar.</div>
    <div class="small">Funciona en qualsevol navegador. Ideal per Codespaces (preview) o local.</div>
  </div>

  <script>
    (function(){
      const diceEl = document.getElementById('dice');
      const rollBtn = document.getElementById('rollBtn');
      const fastBtn = document.getElementById('fastBtn');
      const multiBtn = document.getElementById('multiBtn');
      const soundToggle = document.getElementById('soundToggle');
      const resultText = document.getElementById('resultText');

      const faces = ['+','+','-','-','0','0'];
      let audioOn = true;
      let audioCtx = null;

      function beep(time=0.02, freq=880){
        if(!audioOn) return;
        try {
          if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
          const o = audioCtx.createOscillator();
          const g = audioCtx.createGain();
          o.type = 'sine';
          o.frequency.value = freq;
          g.gain.value = 0.08;
          o.connect(g); g.connect(audioCtx.destination);
          o.start();
          g.gain.setTargetAtTime(0, audioCtx.currentTime + time, 0.01);
          o.stop(audioCtx.currentTime + time + 0.02);
        } catch(e) {
          // navegador que no permet audio per cross-origin / autoplay
        }
      }

      function colorFor(face){
        if(face === '+') return 'var(--plus)';
        if(face === '-') return 'var(--minus)';
        return 'var(--zero)';
      }

      // animaci√≥ principal: velocitat inicial, passos aleatoris, frenada progresiva
      function rollAnimated({minSteps=20, maxSteps=36, startSpeed=60} = {}) {
        return new Promise(resolve => {
          // startSpeed: interval en ms entre canvis inicial
          let steps = Math.floor(Math.random() * (maxSteps - minSteps + 1)) + minSteps;
          let currentStep = 0;
          let interval = startSpeed;
          let face = faces[0];

          resultText.textContent = 'Llan√ßant...';
          rollBtn.disabled = true;
          fastBtn.disabled = true;
          multiBtn.disabled = true;

          function tick(){
            currentStep++;
            face = faces[Math.floor(Math.random() * faces.length)];
            diceEl.textContent = face;
            diceEl.style.color = colorFor(face);

            // efecte de rebot suau (canvia mida moment√†niament)
            diceEl.style.transform = 'scale(1.05)';
            setTimeout(()=> diceEl.style.transform = 'scale(1)', interval/2);

            beep(0.01, 900 - currentStep*2);

            // augmenta interval per simular frenada (no lineal)
            const t = currentStep / steps;
            // easing: accelera l'augment al final (ease-out cubic)
            const ease = 1 - Math.pow(1 - t, 3);
            interval = startSpeed + Math.floor(ease * 700); // final pot ser molt lent

            if(currentStep >= steps){
              // una petita seq√º√®ncia final de "puntets" dram√†tics abans d'aturar
              setTimeout(()=> {
                let dots = 0;
                const dotI = setInterval(()=>{
                  diceEl.textContent = (dots % 2 === 0) ? '.' : face;
                  dots++;
                  if(dots > 4){
                    clearInterval(dotI);
                    diceEl.textContent = face;
                    resultText.textContent = `Resultat final: ${face}`;
                    rollBtn.disabled = false;
                    fastBtn.disabled = false;
                    multiBtn.disabled = false;
                    resolve(face);
                  }
                }, 180);
              }, 100);
              return;
            }

            // programa seg√ºent tick amb el nou interval
            setTimeout(tick, interval);
          }

          // iniciar la primera iteraci√≥
          setTimeout(tick, 0);
        });
      }

      // handlers
      rollBtn.addEventListener('click', ()=> {
        rollAnimated({minSteps:22, maxSteps:36, startSpeed:40});
      });

      fastBtn.addEventListener('click', ()=> {
        rollAnimated({minSteps:8, maxSteps:16, startSpeed:25});
      });

      multiBtn.addEventListener('click', async ()=> {
        // llan√ßa 10 vegades seguides, mostra comptador
        const counts = {'+':0,'-':0,'0':0};
        resultText.textContent = 'Executant 10 llan√ßaments...';
        rollBtn.disabled = true; fastBtn.disabled = true; multiBtn.disabled = true;
        for(let i=0;i<10;i++){
          const face = await rollAnimated({minSteps:12, maxSteps:20, startSpeed:30});
          counts[face]++;
          resultText.textContent = `Proves: ${i+1}/10 ‚Äî +:${counts['+']}  -:${counts['-']}  0:${counts['0']}`;
          await new Promise(r=>setTimeout(r, 300));
        }
        resultText.textContent = `Fet ‚Äî Comptes: +:${counts['+']}  -:${counts['-']}  0:${counts['0']}`;
        rollBtn.disabled = false; fastBtn.disabled = false; multiBtn.disabled = false;
      });

      soundToggle.addEventListener('click', ()=>{
        audioOn = !audioOn;
        soundToggle.textContent = 'So: ' + (audioOn ? 'ON' : 'OFF');
      });

      // inicialitza visual
      diceEl.style.color = colorFor(diceEl.textContent || '+');

      // tecla espai per llan√ßar r√†pid
      window.addEventListener('keydown', (e)=>{
        if(e.code === 'Space' && !rollBtn.disabled){
          e.preventDefault();
          rollAnimated({minSteps:20, maxSteps:34, startSpeed:35});
        }
      });
    })();
  </script>
</body>
</html>
